<?xml version='1.0' encoding='UTF-8'?><!DOCTYPE mapper PUBLIC '-//mybatis.org//DTD Mapper 3.0//EN' 'conf/dtd/mybatis-3-mapper.dtd'><mapper namespace='DebugUsage'>
   <resultMap id='get-debug-usage-result' type='com.mirth.connect.model.DebugUsage'>
      <result property='id' column='ID' jdbcType='INTEGER'/>
      <result property='serverId' column='SERVER_ID'/>
      <result property='deployCount' column='DEPLOY_COUNT'/>
      <result property='invocationCount' column='INVOCATION_COUNT'/>
      <result property='postprocessorCount' column='POSTPROCESSOR_COUNT'/>
      <result property='preprocessorCount' column='PREPROCESSOR_COUNT'/>
      <result property='undeployCount' column='UNDEPLOY_COUNT'/>
      <result property='lastSent' column='LAST_SENT'/>
   </resultMap>
   <select id='getDebugUsageStatistics'
           parameterType='java.lang.String'
           resultMap='get-debug-usage-result'>
		SELECT ID, 
			server_id,
			dupp_count,
		    attach_batch_count,
		    source_connector_count,
		    source_filter_trans_count,
		    destination_filter_trans_count,
		    destination_connector_count,
		    response_count,
		    invocation_count,
		    last_sent
		FROM PUBLIC.DEBUGGER_USAGE
		WHERE SERVER_ID = #{serverId}
	</select>
   <insert id='insertDebugUsageStatistics' parameterType='java.util.Map'>
		INSERT INTO 
		DEBUGGER_USAGE(server_id,
			dupp_count,
		    attach_batch_count,
		    source_connector_count,
		    source_filter_trans_count,
		    destination_filter_trans_count,
		    destination_connector_count,
		    response_count,
		    invocation_count)
		VALUES (#{serverId,jdbcType=VARCHAR},
		    #{duppCount, jdbcType=INTEGER},
		    #{attachBatchCount, jdbcType=INTEGER},
		    #{sourceConnectorCount, jdbcType=INTEGER},
		    #{sourceFilterTransCount, jdbcType=INTEGER},
		    #{destinationFilterTransCount, jdbcType=INTEGER},
		    #{destinationConnectorCount, jdbcType=INTEGER},
		    #{responseCount, jdbcType=INTEGER},
		    #{invocationCount, jdbcType=INTEGER})	
   </insert>

   <update id='updateDebugUsageStatistics' parameterType='java.util.Map'>
	   	UPDATE DEBUGGER_USAGE
	   	SET dupp_count = dupp_count + #{duppCount, jdbcType=INTEGER},
		    attach_batch_count = attach_batch_count + #{attachBatchCount, jdbcType=INTEGER},
		    source_connector_count = source_connector_count + #{sourceConnectorCount, jdbcType=INTEGER},
		    source_filter_trans_count = source_filter_trans_count + #{sourceFilterTransCount, jdbcType=INTEGER},
		    destination_filter_trans_count = destination_filter_trans_count + #{destinationFilterTransCount, jdbcType=INTEGER},
		    destination_connector_count = destination_connector_count + #{destinationConnectorCount, jdbcType=INTEGER},
		    response_count = response_count + #{responseCount, jdbcType=INTEGER},
		    invocation_count = invocation_count + #{invocationCount, jdbcType=INTEGER}
		WHERE SERVER_ID = #{serverId}
	</update>
	
	<update id='resetDebugUsageStatistics' parameterType='java.lang.String'>
		UPDATE FROM DEBUGGER_USAGE
		SET	dupp_count = 0,
		    attach_batch_count = 0,
		    source_connector_count = 0,
		    source_filter_trans_count = 0,
		    destination_filter_trans_count = 0,
		    destination_connector_count = 0,
		    response_count = 0,
		    invocation_count = 0,
		    last_sent = #{lastSent}
		WHERE SERVER_ID = #{serverId};
	</update>
	
	<update id='deleteDebugUsageStatistics' parameterType='java.lang.String'>
		DELETE FROM DEBUGGER_USAGE
		WHERE SERVER_ID = #{value};
	</update>
</mapper>
